/******************************************
 * @name ùêìùê¢ùêùùêöùê•
 * @channel https://t.me/yqc_123
 * @feedback https://t.me/yqc_777
 * @version 1.0.1
******************************************
## ËÑöÊú¨Ê≥®Êòé

    1. Êú¨ËÑöÊú¨‰ªÖ‰æõÂ≠¶‰π†‰∫§ÊµÅÔºåÁ¶ÅÊ≠¢Áî®‰∫éÂïÜ‰∏öÁî®ÈÄîÔºåËøùËÄÖÂêéÊûúËá™Ë¥ü„ÄÇ
    2. ËΩ¨ËΩΩËÑöÊú¨ËØ∑Ê≥®ÊòéÊù•Ê∫êÔºåÊ¨¢ËøéÂàÜ‰∫´ÔºåÊãíÁªùÂÄíÂçñÔºåÂÄíÂçñüêïÂøÖÊ≠ªüêé„ÄÇ
    3. Ê¨¢ËøéÂØπÊú¨‰ªìÂ∫ì(https://github.com/Yuheng0101/X)Star‚úÖÔºå‰ΩÜËØ∑‰∏çË¶ÅFork‚ùå„ÄÇ

## Êõ¥Êñ∞Êó•Âøó

### 20231103

    ‰øÆÂ§çÈÉ®ÂàÜÁî®Êà∑Êó†Ê≥ïËß£ÈîÅÁöÑÈóÆÈ¢ò

### 20231031

    ÂÖºÂÆπSurge„ÄÅLoon„ÄÅQuantumult XÁ≠âÂπ≥Âè∞

## ËÑöÊú¨ÊèèËø∞

    Ëß£ÈîÅ HiFi Plus ÊùÉÈôê

## ‰ΩøÁî®ÊñπÊ≥ï

[Quantumult X](https://raw.githubusercontent.com/Yuheng0101/X/main/Scripts/TIDAL/tidal.snippet)

[Surge](https://raw.githubusercontent.com/Yuheng0101/X/main/Scripts/TIDAL/tidal.sgmodule)

[Loon](https://raw.githubusercontent.com/Yuheng0101/X/main/Scripts/TIDAL/tidal.plugin)

## ‰∏ãËΩΩÂú∞ÂùÄ

    https://apps.apple.com/us/app/tidal-music-hifi-ad-free/id913943275

******************************************/
const $ = new Env(`ùêìùê¢ùêùùêöùê•`)
const isRequest = typeof $request != 'undefined'
const qs = $.isNode() ? require('querystring') : new querystring()
var version_='jsjiami.com.v7';function _0x46aa(_0x248d9b,_0x33c0bd){const _0x38a42d=_0x38a4();return _0x46aa=function(_0x46aaa4,_0x590df0){_0x46aaa4=_0x46aaa4-0x1c5;let _0xa93993=_0x38a42d[_0x46aaa4];if(_0x46aa['NIXQBc']===undefined){var _0x3b0883=function(_0x141160){const _0x5a3a1d='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xd62df1='',_0xa7a3a5='';for(let _0x34db9f=0x0,_0xeaf751,_0x563128,_0x10d5bc=0x0;_0x563128=_0x141160['charAt'](_0x10d5bc++);~_0x563128&&(_0xeaf751=_0x34db9f%0x4?_0xeaf751*0x40+_0x563128:_0x563128,_0x34db9f++%0x4)?_0xd62df1+=String['fromCharCode'](0xff&_0xeaf751>>(-0x2*_0x34db9f&0x6)):0x0){_0x563128=_0x5a3a1d['indexOf'](_0x563128);}for(let _0x50f292=0x0,_0x195190=_0xd62df1['length'];_0x50f292<_0x195190;_0x50f292++){_0xa7a3a5+='%'+('00'+_0xd62df1['charCodeAt'](_0x50f292)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xa7a3a5);};const _0x402dff=function(_0x5ffc42,_0x134aaf){let _0x46a811=[],_0x505e5e=0x0,_0x4979c6,_0x2c2a8e='';_0x5ffc42=_0x3b0883(_0x5ffc42);let _0x2f0c96;for(_0x2f0c96=0x0;_0x2f0c96<0x100;_0x2f0c96++){_0x46a811[_0x2f0c96]=_0x2f0c96;}for(_0x2f0c96=0x0;_0x2f0c96<0x100;_0x2f0c96++){_0x505e5e=(_0x505e5e+_0x46a811[_0x2f0c96]+_0x134aaf['charCodeAt'](_0x2f0c96%_0x134aaf['length']))%0x100,_0x4979c6=_0x46a811[_0x2f0c96],_0x46a811[_0x2f0c96]=_0x46a811[_0x505e5e],_0x46a811[_0x505e5e]=_0x4979c6;}_0x2f0c96=0x0,_0x505e5e=0x0;for(let _0x4909cd=0x0;_0x4909cd<_0x5ffc42['length'];_0x4909cd++){_0x2f0c96=(_0x2f0c96+0x1)%0x100,_0x505e5e=(_0x505e5e+_0x46a811[_0x2f0c96])%0x100,_0x4979c6=_0x46a811[_0x2f0c96],_0x46a811[_0x2f0c96]=_0x46a811[_0x505e5e],_0x46a811[_0x505e5e]=_0x4979c6,_0x2c2a8e+=String['fromCharCode'](_0x5ffc42['charCodeAt'](_0x4909cd)^_0x46a811[(_0x46a811[_0x2f0c96]+_0x46a811[_0x505e5e])%0x100]);}return _0x2c2a8e;};_0x46aa['IHcgMN']=_0x402dff,_0x248d9b=arguments,_0x46aa['NIXQBc']=!![];}const _0x2dad64=_0x38a42d[0x0],_0x75209a=_0x46aaa4+_0x2dad64,_0xbee196=_0x248d9b[_0x75209a];return!_0xbee196?(_0x46aa['JehXTj']===undefined&&(_0x46aa['JehXTj']=!![]),_0xa93993=_0x46aa['IHcgMN'](_0xa93993,_0x590df0),_0x248d9b[_0x75209a]=_0xa93993):_0xa93993=_0xbee196,_0xa93993;},_0x46aa(_0x248d9b,_0x33c0bd);}const _0x14f31d=_0x46aa;(function(_0x3e09ec,_0x418bc7,_0x510628,_0x5c5125,_0x370909,_0x301fd8,_0x148f07){return _0x3e09ec=_0x3e09ec>>0x4,_0x301fd8='hs',_0x148f07='hs',function(_0x5bcf4c,_0xb1e967,_0x50d941,_0x261778,_0x399331){const _0x59c144=_0x46aa;_0x261778='tfi',_0x301fd8=_0x261778+_0x301fd8,_0x399331='up',_0x148f07+=_0x399331,_0x301fd8=_0x50d941(_0x301fd8),_0x148f07=_0x50d941(_0x148f07),_0x50d941=0x0;const _0x2044b5=_0x5bcf4c();while(!![]&&--_0x5c5125+_0xb1e967){try{_0x261778=-parseInt(_0x59c144(0x1df,'R@ra'))/0x1*(parseInt(_0x59c144(0x1e4,'#G1m'))/0x2)+-parseInt(_0x59c144(0x1e2,'rSv8'))/0x3*(parseInt(_0x59c144(0x1fa,'f8xQ'))/0x4)+parseInt(_0x59c144(0x207,'f](b'))/0x5+parseInt(_0x59c144(0x1c9,'3*wp'))/0x6*(parseInt(_0x59c144(0x1f7,'%bFu'))/0x7)+parseInt(_0x59c144(0x1d9,'E%Ul'))/0x8*(parseInt(_0x59c144(0x1f1,'#yKI'))/0x9)+parseInt(_0x59c144(0x1d7,'IrS('))/0xa*(parseInt(_0x59c144(0x1e7,'f8xQ'))/0xb)+-parseInt(_0x59c144(0x1fc,'V5MZ'))/0xc;}catch(_0x57e4d0){_0x261778=_0x50d941;}finally{_0x399331=_0x2044b5[_0x301fd8]();if(_0x3e09ec<=_0x5c5125)_0x50d941?_0x370909?_0x261778=_0x399331:_0x370909=_0x399331:_0x50d941=_0x399331;else{if(_0x50d941==_0x370909['replace'](/[hDGbQCNJHOnPUtgEXV=]/g,'')){if(_0x261778===_0xb1e967){_0x2044b5['un'+_0x301fd8](_0x399331);break;}_0x2044b5[_0x148f07](_0x399331);}}}}}(_0x510628,_0x418bc7,function(_0x2463d7,_0x5cadae,_0x5eaeb2,_0x15bece,_0x165a5d,_0x4db601,_0x22d1b9){return _0x5cadae='\x73\x70\x6c\x69\x74',_0x2463d7=arguments[0x0],_0x2463d7=_0x2463d7[_0x5cadae](''),_0x5eaeb2='\x72\x65\x76\x65\x72\x73\x65',_0x2463d7=_0x2463d7[_0x5eaeb2]('\x76'),_0x15bece='\x6a\x6f\x69\x6e',(0x145ceb,_0x2463d7[_0x15bece](''));});}(0xc50,0xe40b4,_0x38a4,0xc7),_0x38a4)&&(version_=_0x14f31d(0x1d2,'Mvn&'));async function Main(){const _0x27dbda=_0x14f31d,_0x4355dc={'pRaKa':_0x27dbda(0x201,'OwkG'),'SuoGg':'api.tidal.com','yVMIU':function(_0x17b6db,_0x21b1c3){return _0x17b6db(_0x21b1c3);},'ajrzE':function(_0x463d99,_0x401125){return _0x463d99&&_0x401125;},'QpPjK':_0x27dbda(0x1e5,'OwkG'),'oSjiX':_0x27dbda(0x1ea,'EENI'),'bzpgY':'TidalRauth','kXwoP':function(_0x3eb89a){return _0x3eb89a();}},_0x11f9e1=async()=>{const _0x579df1=_0x27dbda,_0x3420a0={'url':$request['url'][_0x579df1(0x1dd,'SMhb')](/audioquality=.*?&/,_0x4355dc[_0x579df1(0x1d3,'#8TS')]),'method':_0x579df1(0x1c8,'SMhb'),'headers':{'Host':_0x4355dc[_0x579df1(0x1fb,'#8TS')],'Authorization':tidalToken,'X-Tidal-Token':X_TIDAL_TOKEN,'User-Agent':_0x579df1(0x1e0,'!*A%')}};try{const _0x34dc79=await _0x4355dc['yVMIU'](Request,_0x3420a0),{status:_0x247412,audioQuality:_0x52741a,subStatus:_0x3b56fa,userMessage:_0x2f7729}=_0x34dc79;return _0x4355dc[_0x579df1(0x204,'O[wX')](!_0x247412,_0x52741a)?{'code':0xc8,'data':_0x34dc79,'success':!0x0}:{'code':_0x3b56fa,'message':codeTextMap[_0x3b56fa]||_0x2f7729,'success':!0x1};}catch(_0x5a6dee){throw _0x5a6dee;}},_0x1dfd73=async()=>{const _0x15c36e=_0x27dbda,_0x105e77={'url':'https://auth.tidal.com/v1/oauth2/token?countryCode=GB&deviceType=PHONE&locale=en','method':_0x4355dc[_0x15c36e(0x1db,'TVNX')],'headers':{'User-Agent':_0x15c36e(0x1c5,'#8TS'),'Authorization':TIDAL_AUTH,'X-Tidal-Token':X_TIDAL_TOKEN},'body':qs[_0x15c36e(0x1d8,'p!Kf')]({'client_id':_0x15c36e(0x1fe,'r0#@'),'scope':_0x4355dc['oSjiX'],'grant_type':_0x15c36e(0x1cb,'h%z*'),'refresh_token':TIDAL_REFRESH_TOKEN,'client_secret':_0x15c36e(0x1f0,'6v)y'),'appMode':_0x15c36e(0x1f2,'jvq4')})};try{const _0x463ed7=await _0x4355dc['yVMIU'](Request,_0x105e77),{access_token:_0x3ce86b,token_type:_0x5d1de3}=_0x463ed7;if(!_0x3ce86b)throw _0x15c36e(0x1e9,'Gzs7');tidalToken=_0x5d1de3+'\x20'+_0x3ce86b,console[_0x15c36e(0x1f4,'qAQT')](_0x15c36e(0x202,'p!Kf')),$[_0x15c36e(0x1e6,'H1U&')](tidalToken,_0x4355dc[_0x15c36e(0x1e3,'7tWY')]);}catch(_0x707add){throw _0x707add;}};!tidalToken&&await _0x1dfd73();const {code:_0x401482,data:_0xa05a54,message:_0x4d5b9e}=await _0x4355dc[_0x27dbda(0x1de,'EENI')](_0x11f9e1);if(0xc8==_0x401482)console[_0x27dbda(0x1ff,'Ivn#')](_0x27dbda(0x1eb,'You)')),response=_0xa05a54;else{if(0x138b===_0x401482){console[_0x27dbda(0x205,'Hs)f')](_0x27dbda(0x208,'vWcT')),await _0x4355dc['kXwoP'](_0x1dfd73);const {success:_0x2274b1,data:_0x4897e3,message:_0x179665}=await _0x11f9e1();console[_0x27dbda(0x1ec,'Mvn&')]('‚úÖËØ∑Ê±ÇÊàêÂäü'),!_0x2274b1&&$[_0x27dbda(0x1cc,'You)')]($['name'],_0x179665,''),response=_0x4897e3;}else $[_0x27dbda(0x1cf,'hXCA')]($['name'],_0x4d5b9e,'');}}const codeTextMap={0x2afb:'TidalÂèÇÊï∞ËøáÊúü!',0x138b:_0x14f31d(0x1ee,'AS(u')},X_TIDAL_TOKEN='1MV2MrP38hSCPnzi',TIDAL_AUTH=_0x14f31d(0x1fd,'3*wp'),TIDAL_REFRESH_TOKEN=_0x14f31d(0x1e8,'V5MZ');function _0x38a4(){const _0x5cb85f=(function(){return[version_,'UjsVjhiDEaJVmnXit.DgOcoGbmNg.Uv7HPPPbOQC==','rCkAWPq0W5C','WQVdQSo2WRRcG8kUW6q','amk1wSoj','WRRdRKzcsH/dOq','WQvQW7aFWOa9W7LKfCkhka','WRpdLMpdQe0fxCkVW5ZcTSk9WQTKi8oiwJybcZxcUmojW4NcPNddMIFcL8oDWRXWW64JiCoEWOpdTHBcHCo2WRihW6NdHCo3WRLLWQVdQSkMW5jZWRZdLuSIW6L2W5KOWPhdKmopWRGzfCkohIfZWOqhWPe1DSk6mbldKJ8cWRP7WPnZu8o0nmkxW6yHcCodhsOOo8knvefboY1/lc3dOJ7dSZLeeK7dQmoqjeldMwhcGCkalf5VpCosWQ/dJ8o3iCo7W7RdLb9fW4imkGayWO/cOSo1W7JcV0eVW47cPCkwzs3dOCocEeNdJKbKWO3dGbpdTCkZtbpdKvLIe8oYtSkDhhLJeZVdTSokWP8PW6ufWOaeWRXksMxcRcNcM8keqh/cVCkbqxFdN8oaW6HLWRBcK8kBWRfkWPiAW6ZdGCouqmouf8kRWQXfWP/dUCkLW7nWfxuOWRFcMmo6aN4FW5hdI8kJthGKrmkShCkqWR3dO8ohWRX7yCkNWPGYl8kZW63dRM7dPCokjwRcUCk+e0LxWQBdJ8oewghcNI0+W5xdLSkLvSoDFSoIlCooW6DHqCkzBLJcKCozeCo6W5FcTCoDWRVcMM/cG8oTW77dRbzxWQ7cOh49eYfReI5wFeVcNbBdTmk1W4tcI8keWPVdVG87W5SjWOnoWPmooJnvzmoOWRhdLIRcHZtcPH/cUSozhwJcGSkTWP3cMCkDlmoaBCopAvPjvSolxaTtWPFdVSoYqmkigLuFWQ8VjCkjW4VdNCoqc8ohFZHfBXZdU8kJBgyms8oJAmkCbqLTW64+W4VdUSoyWRVcIq5asSolWRFdVCkDkwFdJ8oKqIhcSmkuwmoIW7NcSLRdRq/dS8oyW50hcsbhghOCbmoDmCkqdLBcTCkxWRj4W44','6i2u5y6flCkZWRvhW6BcOGfVySk4WQqU5Ass6ls4','W4n4FmoyDSk3jHWUeZ/dGSkXp2uJWPC','4P+56k2h5Ro85OUS5yIA','n8kwWQO','WRntW6PvW4/dTmocDSk4W6yXWP3cJr8U','WQ9UW5PKWOZOT6pLJjVOVOdMNOFdTq','W7ddLf/dRW','u8kAtNr8trFcT2hdGhzEESkYkCkPW53dThSwW4BcSvJdK0emWOXgB2mLCWv0WR/cHxRcMmkuW57cVYeDWRq','W4JdUmoAWQaDW7mzWOVdT8k/WP/dLSo7','deNdGW','fCogWQpcGmkjW57cOSkQjSoxsCo7W5G','WPVcRmol','W47dSmosWQeDWOvgWPRdOmkuWP8','h1y6W64PW6RcH8o4qG9VpG','W6pcJCkQW4a/DmorqmkEWQVdUG','W50rW5ZcGG'].concat((function(){return['WQtcG8oIWPa/jeBcLMW','WQbQWOThW5eFW7ri','WPtdSe4bjq','W6xcNrdcOX5Go8o0W4dcICkyWRfEaa','oqxcQhRcHNhdSmkStI7dKc4yoCkXW6VcUWStWQtcVmooCmo8pCkGW47cImoHWQSLW5LKvxNdPmoaWRFdRbDxWOtdGYvlWQ/cKmkqBmkwjLxdQ8k/W4CedSkeWOyXtCkRW6u0hqdcLWnEz8oluwxdICk2WROxW6zvWOiEW4xdKZ/cJgqaW7avwSoFW5JcGmkLW6b6bCksW5alW6lcRmkTnCoMWQ0ZW4ZdQhBdQbugW6FcP8kkWPpcTCkJWOf1gmkhWRaWwbWYzhqkg8oHWOuuWRDRFYJdGCk8qmkmW4LKm8ogbCoKW4yIW6RcQWa2tG85eIDKWOSsWPpdGeHMDmo/W4NdHmk7W5tcQCk2zCoslmkpWOCRg3FdLSo9s8oqd8ktW6lcMmopWQKSW6CgtW0Fi8kmW6FcUb1vvmoHjSoVW6ldMa0NW6rtWQldLmkScCktW6JcJwhcPSowW41EWOxcIspdQ8o4mSkSW4FdKSo3W6KZW6xcPsBcP8kdWOxcTMD+W4dcTSoTDmk3mchcHXCdW44LW7NcPmo6sSkjFmogW75ejmosEg7dKcRcUM7cKmoPhmk5wa7cJMdcSSk6fWhcPNGIW6fiWQXbASoVW7zBWOj8WQlcPSkxAr0IWRS4WQFdLrWmWRhdQZOpC3lcRSklmXhdHGjgW4z+WOzyyhlcKKJdRqOJbSk8zSkjuvNcUSkeWR4wWR9OWOddRSk0WQZcTWRcKmk9WPRcUmoJWOb5FSo9WP3cHJL3W70HWP3dU1rdWOXiW4HPnq1QhMZcJxPQW6tdJSoScCoAWQfdWOveqmomW7f3W7ZdQwOba240o8kdWRGRFmoGWRH7qqv1pM8smv1DkmoevCoIhXtcJSknW4ldLmksWRNcSNfzW5eAW5ZcT8kHvNzMWPVcPmoo','WO4PW4DlnW7cRHtdGmo+F3NdRmoVq8kh','rmo8ua','W74HWQjdW5uEW7SWfCkln8kuySoU','mCkpBCo0WPD+WO3cMCoAy8k9dIzdW5BdMSoiCmkyDa','4P6B5yQc5PAcW77dQCkIodpcMtaOW5GS5OQs5yUC','hvnJW5rA','iJBcLmkRW4q','AmoPbW','n8kFFCo5WPL7WPK','W78QWRJcMmkJomoQq2eHW5JcVmkE','4P6d77IiAGRdP1JcToI1G+wnOEI/UUAFGaGL6ys55PEG55Uh5B2wsmouDmku','WPpdJguhdSoCW7hdOJdcOIZcVCo1W6G7nH3dO8o7WQJcPx4buMH7W64sW73cKY0RW5GwDmo1ANxcNW','WP/dKCokWP/dRq','WRu1W53cO8kRW4RdLqJcMCo2','v8oXiW','qLFdSvNcR2FcNCkUya','WQhdRLnctHNdSW','FgyfW41hnCk6WOmon8oRWPldNG','WPhdG8oz'].concat((function(){return['WOu6iSkXWRPoW6W','lCkvW6BcPmomWOZdKq','BSkvgG','WRtcR8ogWQS5','n8oEpJ7dTui9sW','mCkkWQFdRdJdOf8KWPJdJguBrSk/','WRFdL0aniW','W4RdO1ldVJWaW70','nSk2v3pdHCofW47dGmkRi8kQwKK','WPVcPmkXWOz0WPNdSfldL8o6','WO9iWOpdL8k7zNFdImoqWPK','W63dGuddO8oUWQeWoCk0','WRO4pM5SnMm','D8krW6W','sSkoW5VcVSo/','WRlcLEMuQ+ITPCkH','ySorbYfmW5BdKW','W5P/FSoeva','WPSnvuJcSd/cNdHqsry','WQBdVxVdPqzGWQlcLJDQx8kQb8oooSo8WQtcTbSnWONdVGFcOmklW45JWPRcOmkxW7aEDCovEgXMWQHG','WPmHFUIUVEAZGUAvM+AoMEs6KmkcW6pOR5hNQQZNRihdOqv8zCoNWRC','W77dVmoHW5eTW7ZdNeZdImoMWONdMW'];}()));}()));}());_0x38a4=function(){return _0x5cb85f;};return _0x38a4();};let tidalToken='',response={};(async()=>{const _0x4e2e34=_0x14f31d,_0x4a040b={'cXVRh':_0x4e2e34(0x1d6,'rSv8'),'fUzWf':_0x4e2e34(0x1e1,'YSAm'),'enzOV':'===‚úÖÊ¨ß‰∫ÜÊ¨ß‰∫Ü~==='};tidalToken=$[_0x4e2e34(0x206,'OwkG')](_0x4a040b[_0x4e2e34(0x1d0,'0@A(')])||'',console['log'](_0x4a040b['fUzWf']),isRequest&&await Main(),console[_0x4e2e34(0x1ff,'Ivn#')](_0x4a040b[_0x4e2e34(0x203,'i^9g')]);})()[_0x14f31d(0x1c6,'You)')](_0x2d8678=>$[_0x14f31d(0x1da,'TVNX')]('','‚ùóÔ∏è'+$[_0x14f31d(0x1ef,'p!Kf')]+_0x14f31d(0x1dc,'p!Kf'),_0x2d8678))[_0x14f31d(0x1cd,'Gzs7')](()=>{const _0x486ab8=_0x14f31d,_0x52c84c={'VurwN':_0x486ab8(0x1ed,'AS(u')},_0x53f5ad=$['isQuanX']()?{'status':_0x52c84c['VurwN'],'headers':$request[_0x486ab8(0x1ca,'H1U&')],'body':JSON['stringify'](response)}:{'response':{'status':0xc8,'headers':$request[_0x486ab8(0x1ca,'H1U&')],'body':JSON[_0x486ab8(0x1f9,'0@A(')](response)}};$[_0x486ab8(0x1f8,'IrS(')](_0x53f5ad);});var version_ = 'jsjiami.com.v7';
// prettier-ignore
function Request(t){const o=t.hasOwnProperty("method")?t.method.toLocaleLowerCase():"get";if($.isNode()&&t.hasOwnProperty("use_proxy")&&t.use_proxy){require("dotenv").config();const o=process.env.PROXY_HOST||"127.0.0.1",n=process.env.PROXY_PORT||7890,e=require("tunnel"),i={https:e.httpsOverHttp({proxy:{host:o,port:1*n}})};Object.assign(t,{agent:i})}return new Promise((n,e)=>{$.http[o](t).then(o=>{var e=o.body;if(t.is_format||void 0===t.is_format)try{e=JSON.parse(e)}catch(t){}n(e)}).catch(t=>e(t))})}
// prettier-ignore
function querystring(){return new class{stringify(e,n,r,t){var o=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};return n=n||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map(function(t){var a=encodeURIComponent(o(t))+r;return Array.isArray(e[t])?e[t].map(function(e){return a+encodeURIComponent(o(e))}).join(n):a+encodeURIComponent(o(e[t]))}).filter(Boolean).join(n):t?encodeURIComponent(o(t))+r+encodeURIComponent(o(e)):""}parse(e,n,r,t){function o(e,n){return Object.prototype.hasOwnProperty.call(e,n)}n=n||"&",r=r||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(n);var u=1e3;t&&"number"==typeof t.maxKeys&&(u=t.maxKeys);var i=e.length;u>0&&i>u&&(i=u);for(var c=0;c<i;++c){var p,f,y,l,m=e[c].replace(s,"%20"),d=m.indexOf(r);d>=0?(p=m.substr(0,d),f=m.substr(d+1)):(p=m,f=""),y=decodeURIComponent(p),l=decodeURIComponent(f),o(a,y)?Array.isArray(a[y])?a[y].push(l):a[y]=[a[y],l]:a[y]=l}return a}}}
// prettier-ignore
function Env(t,e){class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,a)=>{s.call(this,t,(t,s,r)=>{t?a(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`üîî${this.name}, ÂºÄÂßã!`)}getEnv(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":void 0}isNode(){return"Node.js"===this.getEnv()}isQuanX(){return"Quantumult X"===this.getEnv()}isSurge(){return"Surge"===this.getEnv()}isLoon(){return"Loon"===this.getEnv()}isShadowrocket(){return"Shadowrocket"===this.getEnv()}isStash(){return"Stash"===this.getEnv()}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const a=this.getdata(t);if(a)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,a)=>e(a))})}runScript(t,e){return new Promise(s=>{let a=this.getdata("@chavy_boxjs_userCfgs.httpapi");a=a?a.replace(/\n/g,"").trim():a;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[i,o]=a.split("@"),n={url:`http://${o}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":i,Accept:"*/*"},timeout:r};this.post(n,(t,e,a)=>s(a))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),a=!s&&this.fs.existsSync(e);if(!s&&!a)return{};{const a=s?t:e;try{return JSON.parse(this.fs.readFileSync(a))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),a=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):a?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const a=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of a)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,a)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[a+1])>>0==+e[a+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,a]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,a,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,a,r]=/^@(.*?)\.(.*?)$/.exec(e),i=this.getval(a),o=a?"null"===i?null:i||"{}":"{}";try{const e=JSON.parse(o);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),a)}catch(e){const i={};this.lodash_set(i,r,t),s=this.setval(JSON.stringify(i),a)}}else s=this.setval(t,e);return s}getval(t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(t);case"Quantumult X":return $prefs.valueForKey(t);case"Node.js":return this.data=this.loaddata(),this.data[t];default:return this.data&&this.data[t]||null}}setval(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(t,e);case"Quantumult X":return $prefs.setValueForKey(t,e);case"Node.js":return this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0;default:return this.data&&this.data[e]||null}}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){switch(t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"],delete t.headers["content-type"],delete t.headers["content-length"]),t.params&&(t.url+="?"+this.queryStr(t.params)),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,a)=>{!t&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,a)});break;case"Quantumult X":this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:a,headers:r,body:i,bodyBytes:o}=t;e(null,{status:s,statusCode:a,headers:r,body:i,bodyBytes:o},i,o)},t=>e(t&&t.error||"UndefinedError"));break;case"Node.js":let s=require("iconv-lite");this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:a,statusCode:r,headers:i,rawBody:o}=t,n=s.decode(o,this.encoding);e(null,{status:a,statusCode:r,headers:i,rawBody:o,body:n},n)},t=>{const{message:a,response:r}=t;e(a,r,r&&s.decode(r.rawBody,this.encoding))})}}post(t,e=(()=>{})){const s=t.method?t.method.toLocaleLowerCase():"post";switch(t.body&&t.headers&&!t.headers["Content-Type"]&&!t.headers["content-type"]&&(t.headers["content-type"]="application/x-www-form-urlencoded"),t.headers&&(delete t.headers["Content-Length"],delete t.headers["content-length"]),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient[s](t,(t,s,a)=>{!t&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,a)});break;case"Quantumult X":t.method=s,this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:a,headers:r,body:i,bodyBytes:o}=t;e(null,{status:s,statusCode:a,headers:r,body:i,bodyBytes:o},i,o)},t=>e(t&&t.error||"UndefinedError"));break;case"Node.js":let a=require("iconv-lite");this.initGotEnv(t);const{url:r,...i}=t;this.got[s](r,i).then(t=>{const{statusCode:s,statusCode:r,headers:i,rawBody:o}=t,n=a.decode(o,this.encoding);e(null,{status:s,statusCode:r,headers:i,rawBody:o,body:n},n)},t=>{const{message:s,response:r}=t;e(s,r,r&&a.decode(r.rawBody,this.encoding))})}}time(t,e=null){const s=e?new Date(e):new Date;let a={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in a)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[e]:("00"+a[e]).substr((""+a[e]).length)));return t}queryStr(t){let e="";for(const s in t){let a=t[s];null!=a&&""!==a&&("object"==typeof a&&(a=JSON.stringify(a)),e+=`${s}=${a}&`)}return e=e.substring(0,e.length-1),e}msg(e=t,s="",a="",r){const i=t=>{switch(typeof t){case void 0:return t;case"string":switch(this.getEnv()){case"Surge":case"Stash":default:return{url:t};case"Loon":case"Shadowrocket":return t;case"Quantumult X":return{"open-url":t};case"Node.js":return}case"object":switch(this.getEnv()){case"Surge":case"Stash":case"Shadowrocket":default:{let e=t.url||t.openUrl||t["open-url"];return{url:e}}case"Loon":{let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}case"Quantumult X":{let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl,a=t["update-pasteboard"]||t.updatePasteboard;return{"open-url":e,"media-url":s,"update-pasteboard":a}}case"Node.js":return}default:return}};if(!this.isMute)switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(e,s,a,i(r));break;case"Quantumult X":$notify(e,s,a,i(r));break;case"Node.js":}if(!this.isMuteLog){let t=["","==============üì£Á≥ªÁªüÈÄöÁü•üì£=============="];t.push(e),s&&t.push(s),a&&t.push(a),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:this.log("",`‚ùóÔ∏è${this.name}, ÈîôËØØ!`,t);break;case"Node.js":this.log("",`‚ùóÔ∏è${this.name}, ÈîôËØØ!`,t.stack)}}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;switch(this.log("",`üîî${this.name}, ÁªìÊùü! üïõ ${s} Áßí`),this.log(),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:$done(t);break;case"Node.js":process.exit(1)}}}(t,e)}